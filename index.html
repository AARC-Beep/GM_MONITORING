<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SeaCrew Log Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
<style>
body { background: #f8f9fa; }
.sidebar {
  position: fixed; top: 0; left: 0; bottom: 0; width: 220px;
  background: #071a2d; color: white; padding: 15px; overflow-y: auto;
}
.sidebar h5 { font-weight: bold; margin-bottom: 1rem; }
.sidebar a {
  display: block; color: #ccc; padding: 8px; border-radius: 5px; text-decoration: none;
}
.sidebar a:hover, .sidebar a.active { background: #0d3053; color: #fff; }
.main-content { margin-left: 240px; padding: 25px; }
.card { border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
.sticky-note {
  position: fixed; bottom: 10px; right: 10px; width: 280px;
  background: #fff9c4; border: 1px solid #f1da7a;
  border-radius: 8px; padding: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}
</style>
</head>

<body>
<div class="sidebar">
  <h5>üõ≥ SeaCrew Log</h5>
  <a href="#" class="nav-link active" data-section="Vessel_Join">Vessel Crew Joining</a>
  <a href="#" class="nav-link" data-section="Arrivals">Arriving Crew</a>
  <a href="#" class="nav-link" data-section="Updates">Daily Updates</a>
  <a href="#" class="nav-link" data-section="Memo">Memo</a>
  <a href="#" class="nav-link" data-section="Training">Training</a>
  <a href="#" class="nav-link" data-section="Pni">P&I / Events</a>

  <hr>
  <a href="https://flightaware.com/live/airport/RPLL" target="_blank">‚úàÔ∏è FlightAware (MNL)</a>
  <a href="https://www.msn.com/en-ph/news" target="_blank">üì∞ MSN News PH</a>
  <a href="https://zoom.earth" target="_blank">üå¶ Zoom Earth</a>
  <a href="https://dmw.gov.ph" target="_blank">üåç DMW</a>
  <a href="https://owwa.gov.ph" target="_blank">ü§ù OWWA</a>
  <a href="https://marina.gov.ph" target="_blank">‚öì MARINA</a>
</div>

<div class="main-content">
  <h3>Daily Routine Log Dashboard</h3>
  <p>Connected to Google Sheet: <b>DAILY ROUTINE LOG</b></p>

  <div id="contentArea">
    <div class="text-muted">Select a section on the left to begin.</div>
  </div>
</div>

<!-- Sticky Note -->
<div class="sticky-note">
  <h6>üóí Quick Note</h6>
  <textarea id="noteArea" class="form-control" rows="4" placeholder="Write something..."></textarea>
  <button class="btn btn-sm btn-primary mt-2" id="saveNote">Save</button>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbxwyy2tSyswRgQ-RZh_zS3e2vrH5tG-H2FB4tnUWShd-eN-sHIlaZEHeyUJHtyc82WWlA/exec";
const navLinks = document.querySelectorAll('.nav-link');
const contentArea = document.getElementById('contentArea');

// Sidebar navigation
navLinks.forEach(link => {
  link.addEventListener('click', e => {
    e.preventDefault();
    navLinks.forEach(l => l.classList.remove('active'));
    link.classList.add('active');
    const section = link.dataset.section;
    loadForm(section);
  });
});

// Load form for section
function loadForm(section) {
  let html = '';
  if (section === 'Vessel_Join' || section === 'Arrivals') {
    html = `
    <div class="card p-4">
      <h5>${section.replace('_', ' ')} Entry</h5>
      <div class="row g-2">
        <div class="col-md-4"><input type="text" id="vessel" placeholder="Vessel" class="form-control"></div>
        <div class="col-md-4"><input type="text" id="port" placeholder="Port" class="form-control"></div>
        <div class="col-md-4"><input type="number" id="noCrew" placeholder="No. of Crew" class="form-control"></div>
        <div class="col-md-4"><input type="text" id="rank" placeholder="Rank" class="form-control"></div>
        <div class="col-md-4"><input type="date" id="date" class="form-control"></div>
        <div class="col-md-4"><input type="text" id="flight" placeholder="Flight" class="form-control"></div>
      </div>
      <button class="btn btn-success mt-3" onclick="submitForm('${section}')">Save</button>
      <div id="tableArea"></div>
    </div>`;
  } else if (section === 'Updates' || section === 'Memo') {
    html = `
    <div class="card p-4">
      <h5>${section} Entry</h5>
      <input type="text" id="title" placeholder="Title" class="form-control mb-2">
      <textarea id="details" placeholder="Details" class="form-control mb-2"></textarea>
      <input type="date" id="date" class="form-control mb-2">
      <button class="btn btn-success" onclick="submitForm('${section}')">Save</button>
      <div id="tableArea"></div>
    </div>`;
  } else {
    html = `
    <div class="card p-4">
      <h5>${section} Entry</h5>
      <input type="text" id="subject" placeholder="Subject" class="form-control mb-2">
      <textarea id="details" placeholder="Details" class="form-control mb-2"></textarea>
      <input type="date" id="date" class="form-control mb-2">
      <button class="btn btn-success" onclick="submitForm('${section}')">Save</button>
      <div id="tableArea"></div>
    </div>`;
  }
  contentArea.innerHTML = html;
  fetchData(section);
}

// Submit to Google Sheet
function submitForm(sheet) {
  const payload = { sheet };
  document.querySelectorAll(`#contentArea input, #contentArea textarea`).forEach(el => {
    payload[el.id] = el.value;
  });

  fetch(scriptURL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  })
  .then(res => res.json())
  .then(() => {
    alert("Saved successfully!");
    fetchData(sheet);
  })
  .catch(err => alert("Error saving data: " + err));
}

// Load data from Google Sheet
function fetchData(sheet) {
  fetch(`${scriptURL}?action=read&sheetName=${sheet}`)
    .then(res => res.json())
    .then(data => {
      const tableArea = document.getElementById('tableArea');
      if (!data.length) return tableArea.innerHTML = "<p class='text-muted mt-3'>No data found.</p>";
      const headers = Object.keys(data[0]);
      let html = "<table class='table table-striped mt-3'><thead><tr>";
      headers.forEach(h => html += `<th>${h}</th>`);
      html += "</tr></thead><tbody>";
      data.forEach(r => {
        html += "<tr>";
        headers.forEach(h => html += `<td>${r[h] || ""}</td>`);
        html += "</tr>";
      });
      html += "</tbody></table>";
      tableArea.innerHTML = html;
    })
    .catch(() => console.log("No data yet."));
}

// Sticky note
document.getElementById('saveNote').addEventListener('click', () => {
  localStorage.setItem('crewNote', document.getElementById('noteArea').value);
  alert("Note saved locally!");
});
document.getElementById('noteArea').value = localStorage.getItem('crewNote') || "";
</script>
</body>
</html>
