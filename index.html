<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SeaCrew Dashboard â€” DAILY ROUTINE LOG</title>

  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Arial, sans-serif;
      background: #f7f8fa;
      color: #222;
      display: flex;
      height: 100vh;
    }

    .sidebar {
      width: 220px;
      background: #071b2f;
      color: #fff;
      display: flex;
      flex-direction: column;
      padding: 10px 0;
      overflow-y: auto;
    }

    .sidebar h2 {
      text-align: center;
      margin: 10px 0;
      font-size: 16px;
    }

    .sidebar a {
      color: #cfd9e6;
      text-decoration: none;
      padding: 10px 20px;
      display: block;
      font-size: 14px;
    }

    .sidebar a:hover {
      background: #0c2f50;
    }

    .main {
      flex: 1;
      padding: 20px 30px;
      overflow-y: auto;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    h1 {
      font-size: 22px;
      color: #0b2447;
    }

    .btn {
      padding: 6px 10px;
      border: none;
      cursor: pointer;
      border-radius: 4px;
    }

    .btn-sync {
      background: #e8f0ff;
      border: 1px solid #8daff9;
      color: #0b2447;
    }

    .btn-clear {
      background: #ffeaea;
      border: 1px solid #f98d8d;
      color: #7a0000;
    }

    .btn-report {
      background: #e8f7ea;
      border: 1px solid #4caf50;
      color: #1b5e20;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
    }

    .card {
      background: white;
      padding: 15px 20px;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .card h3 {
      margin-top: 0;
      font-size: 16px;
      color: #0b2447;
    }

    .card small {
      color: #666;
    }

    .entries {
      margin-top: 10px;
      background: #f9fafc;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 8px;
      font-size: 13px;
      max-height: 100px;
      overflow-y: auto;
    }

    .footer {
      margin-top: 30px;
      font-size: 12px;
      color: #555;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>âš“ SeaCrew â€” PTSC/THRI</h2>
    <a href="#">Dashboard</a>
    <a href="#">Vessel Crew Joining</a>
    <a href="#">Arriving Crew</a>
    <a href="#">Daily Updates</a>
    <a href="#">Memo</a>
    <a href="#">Training</a>
    <a href="#">P&I / Events</a>
    <hr />
    <a href="#">Flights â€” FlightAware (MNL)</a>
    <a href="#">News â€” MSN Philippines</a>
    <a href="#">Weather â€” PAGASA</a>
    <a href="#">DMW â€” Dept. of Migrant Workers</a>
    <a href="#">OWWA â€” Overseas Workers Welfare Admin</a>
    <a href="#">MARINA â€” Maritime Industry Authority</a>
  </div>

  <div class="main">
    <header>
      <div>
        <h1>SeaCrew Dashboard</h1>
        <small>Connected to Google Sheet: <b>DAILY ROUTINE LOG</b></small>
      </div>
      <div>
        <button class="btn btn-sync" onclick="syncFromSheet()">ðŸ”„ Sync from Sheet</button>
        <button class="btn btn-clear" onclick="clearLocal()">ðŸ§¹ Clear Local</button>
        <button class="btn btn-report" onclick="generateMonthlyReport()">ðŸ“˜ Monthly Report (PDF)</button>
      </div>
    </header>

    <div class="grid" id="dashboard">
      <!-- Cards dynamically load here -->
    </div>

    <div class="footer">
      Tip: Use Monthly Report to export all sections into one PDF.<br>
      &copy; 2025 SeaCrew Dashboard.
    </div>
  </div>
<script>
// =============================
// âš“ GOOGLE SHEET CONNECTION
// =============================

// Replace this with your own Google Apps Script Web App URL:
const scriptURL = "https://script.google.com/macros/s/AKfycbwhLD4pBYQ3lgeIYTtSHh33QzKCxI9aGMq7apuwV6cuumbCwzYApaFnZ7MjBhTlL6gAmw/exec"; // Example: https://script.google.com/macros/s/AKfycbyExampleID/exec

// Local backup (for offline use)
let localData = JSON.parse(localStorage.getItem("routineData") || "{}");

// Default sections
const sections = ["Vessel_Join", "Arrivals", "Updates", "Memo", "Training", "Pni"];

// Load dashboard
document.addEventListener("DOMContentLoaded", () => {
  renderDashboard();
});

// =============================
// âš“ RENDER DASHBOARD
// =============================
function renderDashboard() {
  const dash = document.getElementById("dashboard");
  dash.innerHTML = "";

  sections.forEach(sec => {
    const entries = localData[sec] || [];

    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <h3>${sec.replace("_", " ")}</h3>
      <small>${entries.length} entries</small>
      <div class="entries">
        ${entries.map(e => `<div>â€¢ ${e.text} (${e.date})</div>`).join("") || "No data yet."}
      </div>
      <br>
      <textarea id="input_${sec}" placeholder="Enter new log..." rows="2" style="width:100%;"></textarea><br>
      <button class="btn btn-sync" onclick="addEntry('${sec}')">Save Entry</button>
    `;

    dash.appendChild(card);
  });
}

// =============================
// âš“ ADD ENTRY (LOCAL + CLOUD)
// =============================
async function addEntry(section) {
  const text = document.getElementById(`input_${section}`).value.trim();
  if (!text) return alert("Please enter a log first.");

  const entry = {
    text,
    date: new Date().toLocaleString()
  };

  // Save locally
  if (!localData[section]) localData[section] = [];
  localData[section].push(entry);
  localStorage.setItem("routineData", JSON.stringify(localData));

  renderDashboard();

  // Save to Google Sheet
  try {
    await fetch(scriptURL, {
      method: "POST",
      mode: "no-cors",
      body: JSON.stringify({ section, ...entry }),
      headers: { "Content-Type": "application/json" }
    });
    alert("Saved to Google Sheet successfully!");
  } catch (e) {
    console.warn("Offline mode - saved locally only.");
  }

  document.getElementById(`input_${section}`).value = "";
}

// =============================
// âš“ SYNC FROM SHEET (DOWNLOAD)
// =============================
async function syncFromSheet() {
  try {
    const res = await fetch(scriptURL + "?mode=get");
    const data = await res.json();

    localData = data;
    localStorage.setItem("routineData", JSON.stringify(data));
    renderDashboard();

    alert("Data synced from Google Sheet!");
  } catch (e) {
    alert("Failed to sync from Sheet (check internet).");
  }
}

// =============================
// âš“ CLEAR LOCAL DATA
// =============================
function clearLocal() {
  if (confirm("Clear local data?")) {
    localStorage.removeItem("routineData");
    localData = {};
    renderDashboard();
  }
}

// =============================
// âš“ EXPORT (EXAMPLE)
// =============================
function generateMonthlyReport() {
  alert("Report generation will be added next version.");
}
</script>
</body>
</html>
