<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SeaCrew Dashboard ‚Äî DAILY ROUTINE LOG</title>

  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Arial, sans-serif;
      background: #f7f8fa;
      color: #222;
      display: flex;
      height: 100vh;
    }

    .sidebar {
      width: 220px;
      background: #071b2f;
      color: #fff;
      display: flex;
      flex-direction: column;
      padding: 10px 0;
      overflow-y: auto;
    }

    .sidebar h2 {
      text-align: center;
      margin: 10px 0;
      font-size: 16px;
    }

    .sidebar a {
      color: #cfd9e6;
      text-decoration: none;
      padding: 10px 20px;
      display: block;
      font-size: 14px;
    }

    .sidebar a:hover {
      background: #0c2f50;
    }

    .main {
      flex: 1;
      padding: 20px 30px;
      overflow-y: auto;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    h1 {
      font-size: 22px;
      color: #0b2447;
    }

    .btn {
      padding: 6px 10px;
      border: none;
      cursor: pointer;
      border-radius: 4px;
    }

    .btn-sync {
      background: #e8f0ff;
      border: 1px solid #8daff9;
      color: #0b2447;
    }

    .btn-clear {
      background: #ffeaea;
      border: 1px solid #f98d8d;
      color: #7a0000;
    }

    .btn-report {
      background: #e8f7ea;
      border: 1px solid #4caf50;
      color: #1b5e20;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
    }

    .card {
      background: white;
      padding: 15px 20px;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .card h3 {
      margin-top: 0;
      font-size: 16px;
      color: #0b2447;
    }

    .card small {
      color: #666;
    }

    .entries {
      margin-top: 10px;
      background: #f9fafc;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 8px;
      font-size: 13px;
      max-height: 100px;
      overflow-y: auto;
    }

    .footer {
      margin-top: 30px;
      font-size: 12px;
      color: #555;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>‚öì SeaCrew ‚Äî PTSC/THRI</h2>
    <a href="#">Dashboard</a>
    <a href="#">Vessel Crew Joining</a>
    <a href="#">Arriving Crew</a>
    <a href="#">Daily Updates</a>
    <a href="#">Memo</a>
    <a href="#">Training</a>
    <a href="#">P&I / Events</a>
    <hr />
    <a href="#">Flights ‚Äî FlightAware (MNL)</a>
    <a href="#">News ‚Äî MSN Philippines</a>
    <a href="#">Weather ‚Äî PAGASA</a>
    <a href="#">DMW ‚Äî Dept. of Migrant Workers</a>
    <a href="#">OWWA ‚Äî Overseas Workers Welfare Admin</a>
    <a href="#">MARINA ‚Äî Maritime Industry Authority</a>
  </div>

  <div class="main">
    <header>
      <div>
        <h1>SeaCrew Dashboard</h1>
        <small>Connected to Google Sheet: <b>DAILY ROUTINE LOG</b></small>
      </div>
      <div>
        <button class="btn btn-sync" onclick="syncFromSheet()">üîÑ Sync from Sheet</button>
        <button class="btn btn-clear" onclick="clearLocal()">üßπ Clear Local</button>
        <button class="btn btn-report" onclick="generateMonthlyReport()">üìò Monthly Report (PDF)</button>
      </div>
    </header>

    <div class="grid" id="dashboard">
      <!-- Cards dynamically load here -->
    </div>

    <div class="footer">
      Tip: Use Monthly Report to export all sections into one PDF.<br>
      &copy; 2025 SeaCrew Dashboard.
    </div>
  </div>
<script>
// =============================
// ‚öì CONFIGURATION
// =============================
const scriptURL = "https://script.google.com/macros/s/AKfycbwRV0W3veOd81I8XFf4NH3DRXV1_yClB7X2MZorSlFWUJiG0878K4ClpAmjP1DLeRRoBQ/exec"; // <-- Replace with your Google Apps Script Web App URL
const sheetTabs = ["Vessel_Join", "Arrivals", "Updates", "Memo", "Training", "Pni", "ChatBoard"];
let localData = JSON.parse(localStorage.getItem("routineData") || "{}");
let activeSection = "Dashboard";

// =============================
// ‚öì INITIALIZATION
// =============================
document.addEventListener("DOMContentLoaded", () => {
  attachSidebarEvents();
  showSection("Dashboard");
  renderDashboard();
});

// =============================
// ‚öì SIDEBAR NAVIGATION
// =============================
function attachSidebarEvents() {
  document.querySelectorAll(".sidebar a").forEach(link => {
    link.addEventListener("click", (e) => {
      e.preventDefault();
      const section = e.target.getAttribute("data-section");
      showSection(section);
    });
  });
}

function showSection(section) {
  activeSection = section;
  document.querySelectorAll(".main-section").forEach(s => s.style.display = "none");
  const target = document.getElementById(section);
  if (target) target.style.display = "block";
  if (section === "Dashboard") renderDashboard();
  else renderForm(section);
}

// =============================
// ‚öì RENDER DASHBOARD
// =============================
function renderDashboard() {
  const dash = document.getElementById("Dashboard");
  dash.innerHTML = `
    <h2>SeaCrew Dashboard</h2>
    <small>Connected to Google Sheet: <b>DAILY ROUTINE LOG</b></small><br><br>
    ${sheetTabs.map(tab => renderCard(tab)).join("")}
  `;
}

function renderCard(tab) {
  const entries = localData[tab] || [];
  const preview = entries.slice(-3).map(e => {
    if (tab === "Vessel_Join" || tab === "Arrivals")
      return `<div><b>${e.Vessel}</b> ‚Äî ${e.Port}, ${e.No_of_Crew} crew, ${e.Rank}, ${e.Date}, ${e.Flight}</div>`;
    else if (tab === "ChatBoard")
      return `<div><b>${e.Name}</b>: ${e.Message} <small>(${e.Date})</small></div>`;
    else
      return `<div><b>${e.Title || e.Subject}</b> ‚Äî ${e.Details}, ${e.Date}</div>`;
  }).join("");

  return `
  <div class="card">
    <h3>${tab.replace("_", " ")}</h3>
    <small>${entries.length} entries</small>
    <div class="entries">${preview || "No data yet."}</div>
    <button onclick="showSection('${tab}')">Open</button>
  </div>`;
}

// =============================
// ‚öì RENDER FORM FOR SECTION
// =============================
function renderForm(tab) {
  const formContainer = document.getElementById(tab);
  if (!formContainer) return;
  let fieldsHTML = "";

  switch (tab) {
    case "Vessel_Join":
    case "Arrivals":
      fieldsHTML = `
        <input id="Vessel" placeholder="Vessel" />
        <input id="Port" placeholder="Port" />
        <input id="No_of_Crew" type="number" placeholder="No of Crew" />
        <input id="Rank" placeholder="Rank" />
        <input id="Date" type="date" />
        <input id="Flight" placeholder="Flight" />
      `;
      break;
    case "Updates":
    case "Memo":
      fieldsHTML = `
        <input id="Title" placeholder="Title" />
        <textarea id="Details" placeholder="Details"></textarea>
        <input id="Date" type="date" />
      `;
      break;
    case "Training":
    case "Pni":
      fieldsHTML = `
        <input id="Subject" placeholder="Subject" />
        <textarea id="Details" placeholder="Details"></textarea>
        <input id="Date" type="date" />
      `;
      break;
    case "ChatBoard":
      fieldsHTML = `
        <input id="Name" placeholder="Your name" />
        <textarea id="Message" placeholder="Message"></textarea>
        <input id="Date" type="date" />
      `;
      break;
  }

  formContainer.innerHTML = `
    <h2>${tab.replace("_", " ")}</h2>
    <form onsubmit="saveEntry(event, '${tab}')">
      ${fieldsHTML}
      <br><button type="submit" class="btn btn-sync">Save to Sheet</button>
    </form>
    <hr>
    <button onclick="syncFromSheet()">‚ü≥ Sync from Google Sheet</button>
    <button onclick="clearLocal()">üßπ Clear Local</button>
  `;
}

// =============================
// ‚öì SAVE ENTRY
// =============================
async function saveEntry(event, tab) {
  event.preventDefault();

  const entry = {};
  document.querySelectorAll(`#${tab} input, #${tab} textarea`).forEach(i => {
    entry[i.id] = i.value.trim();
  });

  if (!entry.Date) entry.Date = new Date().toISOString().slice(0,10);

  if (!localData[tab]) localData[tab] = [];
  localData[tab].push(entry);
  localStorage.setItem("routineData", JSON.stringify(localData));

  try {
    await fetch(scriptURL, {
      method: "POST",
      mode: "no-cors",
      body: JSON.stringify({ tab, entry }),
      headers: { "Content-Type": "application/json" }
    });
    alert(`Saved to Google Sheet (${tab})`);
  } catch (e) {
    alert("Offline mode ‚Äî saved locally only.");
  }
}

// =============================
// ‚öì SYNC FROM SHEET
// =============================
async function syncFromSheet() {
  try {
    const res = await fetch(scriptURL + "?mode=get");
    const data = await res.json();
    localData = data;
    localStorage.setItem("routineData", JSON.stringify(localData));
    renderDashboard();
    alert("‚úÖ Synced successfully from Google Sheet!");
  } catch (e) {
    alert("‚ö†Ô∏è Failed to sync (check your scriptURL or internet).");
  }
}

// =============================
// ‚öì CLEAR LOCAL
// =============================
function clearLocal() {
  if (confirm("Clear all local stored data?")) {
    localStorage.removeItem("routineData");
    localData = {};
    renderDashboard();
  }
}
</script>
</body>
</html>
