<!doctype html>
<html lang="en">
<head>
  <title>Daily Routine Log</title>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <style>
    :root { --sidebar-width: 240px; }
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; margin:0; background:#f4f6f9; }
    .sidebar { width: var(--sidebar-width); position: fixed; left:0; top:0; bottom:0; background:#0b2a4a; color:#fff; padding:16px; overflow:auto; }
    .sidebar a { display:block; color:#cfe8ff; padding:8px 10px; text-decoration:none; border-radius:6px; margin-bottom:6px; }
    .sidebar a:hover, .sidebar a.active { background:#123855; color:#fff; }
    .content { margin-left: calc(var(--sidebar-width) + 24px); padding:20px 28px; min-height:100vh; }
    .card-slim { padding:12px; border-radius:8px; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,0.06); margin-bottom:14px; }
    .form-row { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    .form-row .form-control { min-width:120px; }
    .fixed-bottom-left { position: fixed; left: 16px; bottom: 16px; z-index: 2000; color: #666; }
    @media (max-width:900px){ .content{ margin-left:12px; margin-right:12px } .sidebar{ position:relative; width:100%; } }
  </style>
</head>
<body>

<nav class="sidebar">
  <h4><i class="fa-solid fa-ship"></i> SeaCrew — PTSC/THRI</h4>
  <a href="#" class="active" onclick="navTo(event,'dashboard')"><i class="fa-solid fa-house"></i> Dashboard</a>
  <a href="#" onclick="navTo(event,'vesselJoin')"><i class="fa-solid fa-ship"></i> Vessel Crew Joining</a>
  <a href="#" onclick="navTo(event,'arrivingCrew')"><i class="fa-solid fa-plane-departure"></i> Arriving Crew</a>
  <a href="#" onclick="navTo(event,'dailyUpdates')"><i class="fa-regular fa-calendar-days"></i> Daily Updates</a>
  <a href="#" onclick="navTo(event,'memo')"><i class="fa-regular fa-sticky-note"></i> Memo</a>
  <a href="#" onclick="navTo(event,'training')"><i class="fa-solid fa-graduation-cap"></i> Training</a>
  <a href="#" onclick="navTo(event,'pni')"><i class="fa-solid fa-calendar-check"></i> P&I / Events</a>
</nav>

<main class="content">
  <h2>SeaCrew Dashboard</h2>
  <p>Connected to Google Sheet: <strong>DAILY ROUTINE LOG</strong></p>

  <section id="dashboard" class="section active">
    <div class="alert alert-info">Use the sidebar to access sections. Entries auto-save to Google Sheet.</div>
  </section>

  <!-- ======== Vessel Join ======== -->
  <section id="vesselJoin" class="section" style="display:none">
    <h4>Vessel Crew Joining</h4>
    <div class="card-slim">
      <div class="form-row">
        <input class="form-control" id="vjVessel" placeholder="Vessel">
        <input class="form-control" id="vjPort" placeholder="Port">
        <input class="form-control" id="vjNo" placeholder="No. of Crew" type="number">
        <input class="form-control" id="vjRank" placeholder="Rank">
        <input class="form-control" id="vjDate" type="date">
        <input class="form-control" id="vjFlight" placeholder="Flight">
        <button class="btn btn-success" onclick="saveData('Vessel_Join')">Save</button>
      </div>
    </div>
  </section>

  <!-- ======== Arrivals ======== -->
  <section id="arrivingCrew" class="section" style="display:none">
    <h4>Arriving Crew</h4>
    <div class="card-slim">
      <div class="form-row">
        <input class="form-control" id="acVessel" placeholder="Vessel">
        <input class="form-control" id="acPort" placeholder="Port">
        <input class="form-control" id="acNo" placeholder="No. of Crew" type="number">
        <input class="form-control" id="acRank" placeholder="Rank">
        <input class="form-control" id="acDate" type="date">
        <input class="form-control" id="acFlight" placeholder="Flight">
        <button class="btn btn-success" onclick="saveData('Arrivals')">Save</button>
      </div>
    </div>
  </section>

  <!-- ======== Daily Updates ======== -->
  <section id="dailyUpdates" class="section" style="display:none">
    <h4>Daily Updates</h4>
    <div class="card-slim">
      <div class="form-row">
        <input class="form-control" id="duTitle" placeholder="Title">
        <input class="form-control" id="duDetails" placeholder="Details">
        <input class="form-control" id="duDate" type="date">
        <button class="btn btn-success" onclick="saveData('Updates')">Save</button>
      </div>
    </div>
  </section>

  <!-- ======== Memo ======== -->
  <section id="memo" class="section" style="display:none">
    <h4>Memo</h4>
    <div class="card-slim">
      <div class="form-row">
        <input class="form-control" id="mTitle" placeholder="Title">
        <input class="form-control" id="mDetails" placeholder="Details">
        <input class="form-control" id="mDate" type="date">
        <button class="btn btn-success" onclick="saveData('Memo')">Save</button>
      </div>
    </div>
  </section>

  <!-- ======== Training ======== -->
  <section id="training" class="section" style="display:none">
    <h4>Training</h4>
    <div class="card-slim">
      <div class="form-row">
        <input class="form-control" id="tSubject" placeholder="Subject">
        <input class="form-control" id="tDetails" placeholder="Details">
        <input class="form-control" id="tDate" type="date">
        <button class="btn btn-success" onclick="saveData('Training')">Save</button>
      </div>
    </div>
  </section>

  <!-- ======== P&I ======== -->
  <section id="pni" class="section" style="display:none">
    <h4>P&amp;I / Events</h4>
    <div class="card-slim">
      <div class="form-row">
        <input class="form-control" id="pSubject" placeholder="Subject">
        <input class="form-control" id="pDetails" placeholder="Details">
        <input class="form-control" id="pDate" type="date">
        <button class="btn btn-success" onclick="saveData('Pni')">Save</button>
      </div>
    </div>
  </section>

  <div class="fixed-bottom-left">© 2025 SeaCrew Dashboard</div>
</main>
<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwMMyiipSu7DxRYAvBnLtEyvyfLndFISEX8ciAviWaTk3m47OtPTrpPYBNlXXaz7ZDxiQ/exec";

// Sidebar navigation
function navTo(event, id) {
  event.preventDefault();
  document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
  event.target.classList.add('active');
  document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
  document.getElementById(id).style.display = 'block';
}

// Auto-submit function
async function saveData(sheetName) {
  let data = { sheet: sheetName, timestamp: new Date().toLocaleString() };

  // Collect fields based on section
  if (sheetName === 'Vessel_Join') {
    data.vessel = document.getElementById('vjVessel').value;
    data.port = document.getElementById('vjPort').value;
    data.noCrew = document.getElementById('vjNo').value;
    data.rank = document.getElementById('vjRank').value;
    data.date = document.getElementById('vjDate').value;
    data.flight = document.getElementById('vjFlight').value;
  } 
  else if (sheetName === 'Arrivals') {
    data.vessel = document.getElementById('acVessel').value;
    data.port = document.getElementById('acPort').value;
    data.noCrew = document.getElementById('acNo').value;
    data.rank = document.getElementById('acRank').value;
    data.date = document.getElementById('acDate').value;
    data.flight = document.getElementById('acFlight').value;
  } 
  else if (sheetName === 'Updates') {
    data.title = document.getElementById('duTitle').value;
    data.details = document.getElementById('duDetails').value;
    data.date = document.getElementById('duDate').value;
  } 
  else if (sheetName === 'Memo') {
    data.title = document.getElementById('mTitle').value;
    data.details = document.getElementById('mDetails').value;
    data.date = document.getElementById('mDate').value;
  } 
  else if (sheetName === 'Training') {
    data.subject = document.getElementById('tSubject').value;
    data.details = document.getElementById('tDetails').value;
    data.date = document.getElementById('tDate').value;
  } 
  else if (sheetName === 'Pni') {
    data.subject = document.getElementById('pSubject').value;
    data.details = document.getElementById('pDetails').value;
    data.date = document.getElementById('pDate').value;
  }

  // Auto submit immediately when clicking “Save”
  try {
    const res = await fetch(SCRIPT_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    showAlert(`✅ Saved to "${sheetName}" sheet successfully!`);
    clearForm(sheetName);
  } catch (err) {
    showAlert('⚠️ Error: Could not save. Check your Apps Script deployment.', true);
    console.error(err);
  }
}

// Clears form after saving
function clearForm(sheetName) {
  const section = document.getElementById(
    sheetName === 'Vessel_Join' ? 'vesselJoin' :
    sheetName === 'Arrivals' ? 'arrivingCrew' :
    sheetName === 'Updates' ? 'dailyUpdates' :
    sheetName === 'Memo' ? 'memo' :
    sheetName === 'Training' ? 'training' :
    'pni'
  );
  section.querySelectorAll('input').forEach(i => i.value = '');
}

// Popup alert
function showAlert(message, isError = false) {
  const div = document.createElement('div');
  div.textContent = message;
  div.className = `alert ${isError ? 'alert-danger' : 'alert-success'}`;
  div.style.position = 'fixed';
  div.style.top = '10px';
  div.style.right = '10px';
  div.style.zIndex = 9999;
  document.body.appendChild(div);
  setTimeout(() => div.remove(), 3000);
}
</script>

</body>
</html>
