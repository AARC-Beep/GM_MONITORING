<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SeaCrew Dashboard — DAILY ROUTINE LOG</title>

  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Arial, sans-serif;
      background: #f7f8fa;
      color: #222;
      display: flex;
      height: 100vh;
    }

    .sidebar {
      width: 220px;
      background: #071b2f;
      color: #fff;
      display: flex;
      flex-direction: column;
      padding: 10px 0;
      overflow-y: auto;
    }

    .sidebar h2 {
      text-align: center;
      margin: 10px 0;
      font-size: 16px;
    }

    .sidebar a {
      color: #cfd9e6;
      text-decoration: none;
      padding: 10px 20px;
      display: block;
      font-size: 14px;
    }

    .sidebar a:hover {
      background: #0c2f50;
    }

    .main {
      flex: 1;
      padding: 20px 30px;
      overflow-y: auto;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    h1 {
      font-size: 22px;
      color: #0b2447;
    }

    .btn {
      padding: 6px 10px;
      border: none;
      cursor: pointer;
      border-radius: 4px;
    }

    .btn-sync {
      background: #e8f0ff;
      border: 1px solid #8daff9;
      color: #0b2447;
    }

    .btn-clear {
      background: #ffeaea;
      border: 1px solid #f98d8d;
      color: #7a0000;
    }

    .btn-report {
      background: #e8f7ea;
      border: 1px solid #4caf50;
      color: #1b5e20;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
    }

    .card {
      background: white;
      padding: 15px 20px;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .card h3 {
      margin-top: 0;
      font-size: 16px;
      color: #0b2447;
    }

    .card small {
      color: #666;
    }

    .entries {
      margin-top: 10px;
      background: #f9fafc;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 8px;
      font-size: 13px;
      max-height: 100px;
      overflow-y: auto;
    }

    .footer {
      margin-top: 30px;
      font-size: 12px;
      color: #555;
    }
  </style>
</head>
<body>
 <div class="sidebar">
  <h3>⚓ SeaCrew — PTSC/THRI</h3>
  <a href="#" data-section="Dashboard">Dashboard</a>
  <a href="#" data-section="Vessel_Join">Vessel Crew Joining</a>
  <a href="#" data-section="Arrivals">Arriving Crew</a>
  <a href="#" data-section="Updates">Daily Updates</a>
  <a href="#" data-section="Memo">Memo</a>
  <a href="#" data-section="Training">Training</a>
  <a href="#" data-section="Pni">P&I / Events</a>
  <hr>
  <a href="https://flightaware.com/live/airport/RPLL" target="_blank">Flights — FlightAware (MNL)</a>
  <a href="https://www.msn.com/en-ph/news" target="_blank">News — MSN Philippines</a>
  <a href="https://www.pagasa.dost.gov.ph/" target="_blank">Weather — PAGASA</a>
  <a href="https://dmw.gov.ph/" target="_blank">DMW — Dept. of Migrant Workers</a>
  <a href="https://owwa.gov.ph/" target="_blank">OWWA — Overseas Workers Welfare Admin</a>
  <a href="https://marina.gov.ph/" target="_blank">MARINA — Maritime Industry Authority</a>
</div>

  <div id="main">
  <div id="Dashboard" class="main-section"></div>
  <div id="Vessel_Join" class="main-section" style="display:none;"></div>
  <div id="Arrivals" class="main-section" style="display:none;"></div>
  <div id="Updates" class="main-section" style="display:none;"></div>
  <div id="Memo" class="main-section" style="display:none;"></div>
  <div id="Training" class="main-section" style="display:none;"></div>
  <div id="Pni" class="main-section" style="display:none;"></div>
</div>

</header>

    <div class="grid" id="dashboard">
      <!-- Cards dynamically load here -->
    </div>

    <div class="footer">
      Tip: Use Monthly Report to export all sections into one PDF.<br>
      &copy; 2025 SeaCrew Dashboard.
    </div>
  </div>
<script>
// =============================
// ⚓ CONFIGURATION
// =============================
const scriptURL = "https://script.google.com/macros/s/AKfycbwJ-QERqA2-s48nxw1kcnsKgEj_LKPDIds60xU7WqvW057WqgM_3KifPruYEJq8SDNayg/exec"; // Replace with your Google Apps Script Web App URL
const sheetTabs = ["Vessel_Join", "Arrivals", "Updates", "Memo", "Training", "Pni"];
let localData = JSON.parse(localStorage.getItem("routineData") || "{}");
let activeSection = "Dashboard";

// =============================
// ⚓ INITIALIZATION
// =============================
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".sidebar a[data-section]").forEach(link => {
    link.addEventListener("click", e => {
      e.preventDefault();
      const section = e.target.getAttribute("data-section");
      showSection(section);
    });
  });
  showSection("Dashboard");
});

// =============================
// ⚓ SECTION HANDLER
// =============================
function showSection(section) {
  activeSection = section;
  document.querySelectorAll(".main-section").forEach(s => s.style.display = "none");
  const target = document.getElementById(section);
  if (target) target.style.display = "block";

  if (section === "Dashboard") renderDashboard();
  else renderForm(section);
}

// =============================
// ⚓ DASHBOARD RENDER
// =============================
function renderDashboard() {
  const dash = document.getElementById("Dashboard");
  dash.innerHTML = `
    <h2>SeaCrew Dashboard</h2>
    <p><small>Connected to Google Sheet: <b>DAILY ROUTINE LOG</b></small></p>
    <div class="grid">
      ${sheetTabs.map(tab => renderCard(tab)).join("")}
    </div>
  `;
}

function renderCard(tab) {
  const entries = localData[tab] || [];
  const preview = entries.slice(-3).map(e => {
    if (tab === "Vessel_Join" || tab === "Arrivals")
      return `<div><b>${e.Vessel}</b> — ${e.Port}, ${e.No_of_Crew} crew, ${e.Rank}, ${e.Date}</div>`;
    else
      return `<div><b>${e.Title || e.Subject}</b> — ${e.Details}, ${e.Date}</div>`;
  }).join("");
  return `
  <div class="card">
    <h3>${tab.replace("_", " ")}</h3>
    <small>${entries.length} entries</small>
    <div>${preview || "No data yet."}</div>
    <button onclick="showSection('${tab}')">Open</button>
  </div>`;
}

// =============================
// ⚓ FORM RENDER
// =============================
function renderForm(tab) {
  const formContainer = document.getElementById(tab);
  let fields = "";
  switch(tab) {
    case "Vessel_Join":
    case "Arrivals":
      fields = `
        <input id="Vessel" placeholder="Vessel">
        <input id="Port" placeholder="Port">
        <input id="No_of_Crew" placeholder="No_of_Crew" type="number">
        <input id="Rank" placeholder="Rank">
        <input id="Date" type="date">
        <input id="Flight" placeholder="Flight">
      `;
      break;
    case "Updates":
    case "Memo":
      fields = `
        <input id="Title" placeholder="Title">
        <textarea id="Details" placeholder="Details"></textarea>
        <input id="Date" type="date">
      `;
      break;
    case "Training":
    case "Pni":
      fields = `
        <input id="Subject" placeholder="Subject">
        <textarea id="Details" placeholder="Details"></textarea>
        <input id="Date" type="date">
      `;
      break;
  }

  formContainer.innerHTML = `
    <h2>${tab.replace("_", " ")}</h2>
    <form onsubmit="saveEntry(event, '${tab}')">
      ${fields}
      <br>
      <button type="submit">Save to Sheet</button>
    </form>
    <button onclick="syncFromSheet()">Sync from Google Sheet</button>
    <button onclick="clearLocal()">Clear Local</button>
  `;
}

// =============================
// ⚓ SAVE ENTRY
// =============================
async function saveEntry(event, tab) {
  event.preventDefault();
  const entry = {};
  document.querySelectorAll(`#${tab} input, #${tab} textarea`).forEach(el => {
    entry[el.id] = el.value.trim();
  });

  if (!entry.Date) entry.Date = new Date().toISOString().slice(0,10);
  if (!localData[tab]) localData[tab] = [];
  localData[tab].push(entry);
  localStorage.setItem("routineData", JSON.stringify(localData));

  try {
    await fetch(scriptURL, {
      method: "POST",
      mode: "no-cors",
      body: JSON.stringify({ tab, entry }),
      headers: { "Content-Type": "application/json" }
    });
    alert(`✅ Saved to Google Sheet (${tab})`);
  } catch (err) {
    alert("⚠️ Offline: saved locally only.");
  }
}

// =============================
// ⚓ SYNC FROM SHEET
// =============================
async function syncFromSheet() {
  try {
    const res = await fetch(scriptURL + "?mode=get");
    const data = await res.json();
    localData = data;
    localStorage.setItem("routineData", JSON.stringify(localData));
    renderDashboard();
    alert("✅ Synced from Google Sheet!");
  } catch (err) {
    alert("❌ Sync failed — check your Web App URL or internet.");
  }
}

// =============================
// ⚓ CLEAR LOCAL STORAGE
// =============================
function clearLocal() {
  if (confirm("Clear all local stored data?")) {
    localStorage.removeItem("routineData");
    localData = {};
    renderDashboard();
  }
}
</script>

</body>
</html>
