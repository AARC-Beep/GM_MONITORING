<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SeaCrew Dashboard ‚Äî PTSC / THRI</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    body {
      background-color: #f8f9fa;
    }
    .sidebar {
      width: 230px;
      position: fixed;
      top: 0; left: 0;
      height: 100vh;
      background-color: #0a2342;
      color: #fff;
      padding-top: 1rem;
    }
    .sidebar h4 {
      text-align: center;
      margin-bottom: 1rem;
      color: #fff;
    }
    .sidebar a {
      color: #fff;
      display: block;
      padding: 10px 20px;
      text-decoration: none;
    }
    .sidebar a:hover {
      background-color: #003366;
    }
    .main {
      margin-left: 240px;
      padding: 1.5rem;
    }
    .card {
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      border-radius: 10px;
    }
    .sticky-note {
      background: #fff8dc;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      min-height: 100px;
      resize: none;
      width: 100%;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h4>üõ≥ SeaCrew<br>PTSC / THRI</h4>
    <a href="#">Dashboard</a>
    <a href="#">Vessel Crew Joining</a>
    <a href="#">Arriving Crew</a>
    <a href="#">Daily Updates</a>
    <a href="#">Memo</a>
    <a href="#">Training</a>
    <a href="#">P&I / Events</a>
    <hr style="border-color:#fff;">
    <a href="https://flightaware.com/live/airport/RPLL" target="_blank">‚úà Flights ‚Äî FlightAware (MNL)</a>
    <a href="https://www.msn.com/en-ph/news" target="_blank">üì∞ News ‚Äî MSN Philippines</a>
    <a href="https://zoom.earth/" target="_blank">üå¶ Weather ‚Äî Zoom Earth</a>
    <a href="https://dmw.gov.ph" target="_blank">üèõ DMW ‚Äî Dept. of Migrant Workers</a>
    <a href="https://owwa.gov.ph" target="_blank">üß≥ OWWA ‚Äî Overseas Workers Welfare Admin</a>
    <a href="https://marina.gov.ph" target="_blank">‚öì MARINA ‚Äî Maritime Industry Authority</a>
  </div>
  <div class="main">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3>SeaCrew Dashboard</h3>
      <div>
        <button class="btn btn-primary btn-sm" id="syncBtn">üîÑ Sync from Sheet</button>
        <button class="btn btn-danger btn-sm" id="clearLocal">üóë Clear Local</button>
      </div>
    </div>
    <div class="row" id="dashboard-cards">
      <!-- Vessel Crew Joining -->
      <div class="col-md-4 mb-3">
        <div class="card">
          <div class="card-body">
            <h6 class="card-title">Vessel Crew Joining</h6>
            <p class="text-muted" id="joinCount">0 entries</p>
            <div id="joinList"></div>
            <div class="d-flex justify-content-between mt-2">
              <button class="btn btn-sm btn-outline-primary" onclick="openForm('Vessel_Join')">Open</button>
              <button class="btn btn-sm btn-outline-secondary" onclick="exportPDF('Vessel_Join')">Export PDF</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Arriving Crew -->
      <div class="col-md-4 mb-3">
        <div class="card">
          <div class="card-body">
            <h6 class="card-title">Arriving Crew</h6>
            <p class="text-muted" id="arriveCount">0 entries</p>
            <div id="arriveList"></div>
            <div class="d-flex justify-content-between mt-2">
              <button class="btn btn-sm btn-outline-primary" onclick="openForm('Arrivals')">Open</button>
              <button class="btn btn-sm btn-outline-secondary" onclick="exportPDF('Arrivals')">Export PDF</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Daily Updates -->
      <div class="col-md-4 mb-3">
        <div class="card">
          <div class="card-body">
            <h6 class="card-title">Daily Updates</h6>
            <p class="text-muted" id="updateCount">0 entries</p>
            <div id="updateList"></div>
            <div class="d-flex justify-content-between mt-2">
              <button class="btn btn-sm btn-outline-primary" onclick="openForm('Updates')">Open</button>
              <button class="btn btn-sm btn-outline-secondary" onclick="exportPDF('Updates')">Export PDF</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Memo -->
      <div class="col-md-4 mb-3">
        <div class="card">
          <div class="card-body">
            <h6 class="card-title">Memo</h6>
            <p class="text-muted" id="memoCount">0 entries</p>
            <div id="memoList"></div>
            <div class="d-flex justify-content-between mt-2">
              <button class="btn btn-sm btn-outline-primary" onclick="openForm('Memo')">Open</button>
              <button class="btn btn-sm btn-outline-secondary" onclick="exportPDF('Memo')">Export PDF</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Training -->
      <div class="col-md-4 mb-3">
        <div class="card">
          <div class="card-body">
            <h6 class="card-title">Training</h6>
            <p class="text-muted" id="trainCount">0 entries</p>
            <div id="trainList"></div>
            <div class="d-flex justify-content-between mt-2">
              <button class="btn btn-sm btn-outline-primary" onclick="openForm('Training')">Open</button>
              <button class="btn btn-sm btn-outline-secondary" onclick="exportPDF('Training')">Export PDF</button>
            </div>
          </div>
        </div>
      </div>

      <!-- P&I / Events -->
      <div class="col-md-4 mb-3">
        <div class="card">
          <div class="card-body">
            <h6 class="card-title">P&amp;I / Events</h6>
            <p class="text-muted" id="pniCount">0 entries</p>
            <div id="pniList"></div>
            <div class="d-flex justify-content-between mt-2">
              <button class="btn btn-sm btn-outline-primary" onclick="openForm('Pni')">Open</button>
              <button class="btn btn-sm btn-outline-secondary" onclick="exportPDF('Pni')">Export PDF</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Blackboard / Chat Sticky Note -->
    <div class="card mt-4">
      <div class="card-body">
        <h6 class="card-title">üìù Blackboard / Sticky Note</h6>
        <textarea id="stickyNote" class="sticky-note" placeholder="Type notes here..."></textarea>
        <button class="btn btn-success btn-sm mt-2" id="saveNote">Save Note</button>
        <button class="btn btn-secondary btn-sm mt-2" id="clearNote">Clear Note</button>
      </div>
    </div>

    <footer class="mt-4 text-muted text-center small">
      Connected to Google Sheet via Apps Script API<br>
      ¬© 2025 TIWALA Human Resources Inc.
    </footer>
  </div>
<script>
// === CONFIGURATION ===
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxwyy2tSyswRgQ-RZh_zS3e2vrH5tG-H2FB4tnUWShd-eN-sHIlaZEHeyUJHtyc82WWlA/exec";

// === FETCH DATA FROM GOOGLE SHEET ===
async function fetchData(sheetName, listId, countId) {
  try {
    const response = await fetch(`${SCRIPT_URL}?sheet=${sheetName}`);
    const data = await response.json();

    if (data && data.length > 1) {
      document.getElementById(countId).innerText = `${data.length - 1} entries`;
      renderList(data.slice(1), listId);
    } else {
      document.getElementById(countId).innerText = `0 entries`;
      document.getElementById(listId).innerHTML = `<p class="text-muted">No data available</p>`;
    }
  } catch (err) {
    console.error(`Error fetching ${sheetName}:`, err);
    document.getElementById(listId).innerHTML = `<p class="text-danger">Failed to load data.</p>`;
  }
}

// === DISPLAY LISTS IN DASHBOARD ===
function renderList(rows, listId) {
  let html = "";
  rows.reverse().forEach(r => {
    const text = r.filter(Boolean).slice(1).join(" ‚Äî ");
    html += `<div>${text}</div>`;
  });
  document.getElementById(listId).innerHTML = html || `<p>No records yet.</p>`;
}

// === EXPORT TO PDF ===
function exportPDF(sheetName) {
  const list = document.getElementById(sheetName.toLowerCase().replace("_", "") + "List").innerHTML;
  const pdfWindow = window.open("", "_blank");
  pdfWindow.document.write(`<html><head><title>${sheetName} Report</title></head><body>${list}</body></html>`);
  pdfWindow.document.close();
  pdfWindow.print();
}

// === OPEN FORM ===
function openForm(sheet) {
  const url = `${SCRIPT_URL}?sheet=${sheet}`;
  window.open(url, "_blank");
}

// === AUTO REFRESH EVERY 30 SECONDS ===
function autoRefresh() {
  fetchAllData();
  setTimeout(autoRefresh, 30000);
}

// === FETCH ALL SHEETS ===
function fetchAllData() {
  fetchData("Vessel_Join", "joinList", "joinCount");
  fetchData("Arrivals", "arriveList", "arriveCount");
  fetchData("Updates", "updateList", "updateCount");
  fetchData("Memo", "memoList", "memoCount");
  fetchData("Training", "trainList", "trainCount");
  fetchData("Pni", "pniList", "pniCount");
}

// === STICKY NOTE FEATURE ===
const noteField = document.getElementById("stickyNote");
const saveBtn = document.getElementById("saveNote");
const clearBtn = document.getElementById("clearNote");

noteField.value = localStorage.getItem("stickyNote") || "";

saveBtn.addEventListener("click", () => {
  localStorage.setItem("stickyNote", noteField.value);
  saveBtn.innerText = "Saved!";
  setTimeout(() => saveBtn.innerText = "Save Note", 2000);
});

clearBtn.addEventListener("click", () => {
  localStorage.removeItem("stickyNote");
  noteField.value = "";
});

// === INITIAL LOAD ===
window.onload = () => {
  fetchAllData();
  autoRefresh();
};
</script>
      <!-- Auto Refresh Function -->
      <script>
        // Refresh every 60 seconds
        setInterval(() => {
          fetch(
            "https://script.google.com/macros/s/AKfycbxwyy2tSyswRgQ-RZh_zS3e2vrH5tG-H2FB4tnUWShd-eN-sHIlaZEHeyUJHtyc82WWlA/exec"
          )
            .then((response) => response.json())
            .then((data) => {
              const tableBody = document.querySelector("#crewTable tbody");
              tableBody.innerHTML = "";
              data.forEach((crew) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                  <td>${crew.Rank || ""}</td>
                  <td>${crew.Name || ""}</td>
                  <td>${crew.Principal || ""}</td>
                  <td>${crew.Status || ""}</td>
                  <td>${crew.Remarks || ""}</td>
                `;
                tableBody.appendChild(row);
              });
            })
            .catch((err) => console.error("Error refreshing data:", err));
        }, 60000); // 60 seconds
      </script>

      <!-- Blackboard / Chat Feature -->
      <section id="blackboard" class="mt-10 p-6 bg-gray-900 text-white rounded-2xl shadow-lg">
        <h2 class="text-xl font-bold mb-4">üìã Crew Blackboard</h2>
        <div class="space-y-3" id="chatArea">
          <!-- Messages will appear here -->
        </div>

        <div class="mt-4 flex space-x-2">
          <input
            type="text"
            id="chatInput"
            placeholder="Type message here..."
            class="flex-1 p-2 rounded-lg text-black"
          />
          <button
            id="sendBtn"
            class="bg-blue-600 px-4 py-2 rounded-lg hover:bg-blue-700 transition"
          >
            Send
          </button>
        </div>
      </section>

      <script>
        const chatArea = document.getElementById("chatArea");
        const sendBtn = document.getElementById("sendBtn");
        const chatInput = document.getElementById("chatInput");

        function addMessage(text) {
          const msg = document.createElement("div");
          msg.className =
            "bg-gray-800 p-2 rounded-lg shadow-sm border border-gray-700";
          msg.textContent = text;
          chatArea.appendChild(msg);
          chatArea.scrollTop = chatArea.scrollHeight;
        }

        sendBtn.addEventListener("click", () => {
          const text = chatInput.value.trim();
          if (text) {
            addMessage("üßë‚Äç‚úàÔ∏è " + text);
            chatInput.value = "";
          }
        });

        chatInput.addEventListener("keypress", (e) => {
          if (e.key === "Enter") sendBtn.click();
        });
      </script>
    </div>
  </body>
</html>

