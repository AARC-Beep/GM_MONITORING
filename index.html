<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SeaCrew Daily Routine Log</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: #f4f6f8;
    }
    #sidebar {
      width: 240px;
      position: fixed;
      top: 0;
      bottom: 0;
      left: 0;
      background: #0d1b2a;
      color: white;
      padding: 20px 0;
    }
    #sidebar h4 {
      text-align: center;
      color: #fff;
      margin-bottom: 20px;
    }
    #sidebar a {
      color: #cdd9e5;
      display: block;
      padding: 10px 20px;
      text-decoration: none;
    }
    #sidebar a:hover, #sidebar a.active {
      background: #1b263b;
      color: #fff;
    }
    #content {
      margin-left: 260px;
      padding: 20px;
    }
    .section {
      display: none;
    }
    .section.active {
      display: block;
    }
  </style>
</head>
<body>
  <div id="sidebar">
    <h4>ðŸ›³ SeaCrew Log</h4>
    <a href="#" class="nav-link active" data-section="join">Vessel Crew Joining</a>
    <a href="#" class="nav-link" data-section="arrivals">Arriving Crew</a>
    <a href="#" class="nav-link" data-section="updates">Daily Updates</a>
    <a href="#" class="nav-link" data-section="memo">Memo</a>
    <a href="#" class="nav-link" data-section="training">Training</a>
    <a href="#" class="nav-link" data-section="pni">P&I / Events</a>
  </div>

  <div id="content">
    <h2>Daily Routine Log Dashboard</h2>
    <p>Connected to Google Sheet: <strong>SeaCrewDB</strong></p>

    <div id="join" class="section active"></div>
    <div id="arrivals" class="section"></div>
    <div id="updates" class="section"></div>
    <div id="memo" class="section"></div>
    <div id="training" class="section"></div>
    <div id="pni" class="section"></div>
  </div>
  <script>
  const scriptURL = "https://script.google.com/macros/s/AKfycbxwyy2tSyswRgQ-RZh_zS3e2vrH5tG-H2FB4tnUWShd-eN-sHIlaZEHeyUJHtyc82WWlA/exec";

  const sections = ["join", "arrivals", "updates", "memo", "training", "pni"];
  const sectionNames = {
    join: "Vessel Crew Joining",
    arrivals: "Arriving Crew",
    updates: "Daily Updates",
    memo: "Memo",
    training: "Training",
    pni: "P&I / Events"
  };

  // ===== Navigation =====
  document.querySelectorAll(".nav-link").forEach(link => {
    link.addEventListener("click", e => {
      e.preventDefault();
      document.querySelectorAll(".nav-link").forEach(l => l.classList.remove("active"));
      link.classList.add("active");
      const target = link.dataset.section;
      document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
      document.getElementById(target).classList.add("active");
    });
  });

  // ===== Build forms dynamically =====
  sections.forEach(id => {
    const container = document.getElementById(id);
    container.innerHTML = `
      <div class="card shadow-sm p-4">
        <h4>${sectionNames[id]}</h4>
        <form class="entryForm" data-sheet="${id}">
          <div class="mb-3">
            <label class="form-label">Date</label>
            <input type="date" class="form-control" name="Date" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Details / Remarks</label>
            <textarea class="form-control" name="Details" rows="3" required></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Entered By</label>
            <input type="text" class="form-control" name="User" required>
          </div>
          <button type="submit" class="btn btn-primary">Save Entry</button>
          <div class="status mt-3 text-success fw-bold"></div>
        </form>
      </div>
    `;
  });

  // ===== Handle form submission =====
  document.querySelectorAll(".entryForm").forEach(form => {
    form.addEventListener("submit", e => {
      e.preventDefault();
      const sheetName = form.dataset.sheet;
      const formData = new FormData(form);
      formData.append("sheetName", sheetName);

      const data = Object.fromEntries(formData.entries());
      const localKey = "local_" + sheetName;

      // Save locally (always)
      let stored = JSON.parse(localStorage.getItem(localKey) || "[]");
      stored.push(data);
      localStorage.setItem(localKey, JSON.stringify(stored));

      // Try sending to Google Sheets
      fetch(scriptURL, { method: "POST", body: formData })
        .then(res => res.text())
        .then(result => {
          form.querySelector(".status").innerHTML = "âœ… Saved to Google Sheets!";
          form.reset();
          // Clear local if success
          localStorage.removeItem(localKey);
        })
        .catch(err => {
          console.log("Offline or error, saved locally:", err);
          form.querySelector(".status").innerHTML = "âš ï¸ Offline â€” saved locally, will sync later.";
        });
    });
  });

  // ===== Sync local data when back online =====
  window.addEventListener("online", () => {
    sections.forEach(sheet => {
      const localKey = "local_" + sheet;
      const unsynced = JSON.parse(localStorage.getItem(localKey) || "[]");
      if (unsynced.length > 0) {
        unsynced.forEach(entry => {
          const fd = new FormData();
          Object.entries(entry).forEach(([k, v]) => fd.append(k, v));
          fd.append("sheetName", sheet);
          fetch(scriptURL, { method: "POST", body: fd })
            .then(() => console.log(`âœ… Synced ${sheet} entry`))
            .then(() => localStorage.removeItem(localKey))
            .catch(err => console.log("Sync error:", err));
        });
      }
    });
  });
    <script>
  // === FETCH DATA FROM GOOGLE SHEETS AND DISPLAY IN TABLE ===
  const fetchDataBtn = document.createElement("button");
  fetchDataBtn.textContent = "ðŸ”„ Refresh Data";
  fetchDataBtn.className = "btn btn-success mt-3";
  document.querySelector(".main-content").prepend(fetchDataBtn);

  fetchDataBtn.addEventListener("click", loadAllData);

  function loadAllData() {
    sections.forEach(sheet => {
      const container = document.getElementById(sheet);
      fetch(`${scriptURL}?action=read&sheetName=${sheet}`)
        .then(res => res.json())
        .then(data => {
          if (!Array.isArray(data) || data.length === 0) {
            container.querySelector(".dataTable")?.remove();
            return;
          }

          // Remove old table if exists
          container.querySelector(".dataTable")?.remove();

          // Create new table
          const table = document.createElement("table");
          table.className = "table table-striped mt-4 dataTable";
          const thead = document.createElement("thead");
          const headers = Object.keys(data[0]);
          thead.innerHTML = `<tr>${headers.map(h => `<th>${h}</th>`).join("")}</tr>`;
          const tbody = document.createElement("tbody");
          data.forEach(row => {
            tbody.innerHTML += `<tr>${headers.map(h => `<td>${row[h] || ""}</td>`).join("")}</tr>`;
          });
          table.appendChild(thead);
          table.appendChild(tbody);
          container.appendChild(table);
        })
        .catch(err => console.log(`Error loading ${sheet}:`, err));
    });
  }

  // Auto load on start
  loadAllData();
  
  </script>
</body>
</html>
